<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Survey</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- <link rel="stylesheet" type="text/css" href="./assets/css/style.css"> -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <style>
        .fieldwidth {
            width: 50%;
        }

        .hide {
            display: none;
        }

        .top {
            top: 2rem;
        }

        img {
            border: 1px solid darkgrey
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card border-dark mb-3" id="survey">
            <div class="card-header h1">Survey Questions</div>
            <div class="card-body text-dark">
                <!-- <h1>Survey Questions</h1> -->
                <h2>About You</h2>
                <form>
                    <div class="form-group">
                        <label for="exampleInputName">Name (required)</label>
                        <input type="name" class="form-control" id="name" aria-describedby="nameHelp"
                            placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label for="exampleInputPhoto">Link to a photo image (or Social Media profile). (required)
                        </label>
                        <input type="url" class="form-control" id="photo"
                            placeholder="http://lorempixel.com/400/200/people/">
                    </div>
                    <hr>
                    <div class="form-group">
                        <h3>Question 1</h3>
                        <h4>I live for a musical episode of a show.</h4>
                        <select class="form-control fieldwidth" id="q1">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 2</h3>
                        <h4>I like fantasy shows that rely on the supernatural, magic, or powers of some kind?</h4>
                        <select class="form-control fieldwidth" id="q2">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 3</h3>
                        <h4>I love a show that explores family disfunction.</h4>
                        <select class="form-control fieldwidth" id="q3">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 4</h3>
                        <h4>I just want a good cry and some ice cream.</h4>
                        <select class="form-control fieldwidth" id="q4">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 5</h3>
                        <h4>I want eye candy over laughter.</h4>
                        <select class="form-control fieldwidth" id="q5">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 6</h3>
                        <h4>I prefer a limited series. 20 episode seasons are too much.</h4>
                        <select class="form-control fieldwidth" id="q6">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 7</h3>
                        <h4>I love a conspiracy theory!</h4>
                        <select class="form-control fieldwidth" id="q7">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 8</h3>
                        <h4>20 main characters... not a problem.</h4>
                        <select class="form-control fieldwidth" id="q8">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 9</h3>
                        <h4>I'm okay with never seeing my fav characters go to work.</h4>
                        <select class="form-control fieldwidth" id="q9">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <h3>Question 10</h3>
                        <h4>Time travel and science talk give me headaches.</h4>
                        <select class="form-control fieldwidth" id="q10">
                            <option>1 (Strongly Disagree)</option>
                            <option>2</option>
                            <option>3 (Neutral) </option>
                            <option>4</option>
                            <option>5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" id="submit">Submit</button>
                </form>
            </div>
        </div>


        <div class="card border-dark mb-3 hide" id="results">
            <div class="card-header h1">Results</div>
            <div class="card-body text-dark text-center" id="result-body">

            </div>
        </div>
    </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        $("#submit").on("click", function (event) {
            event.preventDefault();
            console.log("click")
            let q1 = $("#q1").find(":selected").text()[0]
            let q2 = $("#q2").find(":selected").text()[0]
            let q3 = $("#q3").find(":selected").text()[0]
            let q4 = $("#q4").find(":selected").text()[0]
            let q5 = $("#q5").find(":selected").text()[0]
            let q6 = $("#q6").find(":selected").text()[0]
            let q7 = $("#q7").find(":selected").text()[0]
            let q8 = $("#q8").find(":selected").text()[0]
            let q9 = $("#q9").find(":selected").text()[0]
            let q10 = $("#q10").find(":selected").text()[0]

            // define an object that POST request will send to server
            var newUser = {
                name: $("#name").val().trim(),
                photo: $("#photo").val().trim(),
                score: [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10]
            }
            console.log(newUser)
            // url validation logic
            let httpCheck = /http:/g
            let httpsCheck = /https:/g
            if (newUser.name.trim() === "") {
                alert("Please enter a name");
                // if photo url field is blank or doesn't have http or https at index 0
            } else if (newUser.photo.trim() === "" || newUser.photo.search(httpCheck) !== 0 && newUser.photo.search(httpsCheck) !== 0) {
                alert("Please enter in a URL")
            } else {
                // validations passed, make a POST call to server
                $.post("/api/users", newUser).then(function (data) {
                    if (data) {
                        // log available data
                        console.log(data)

                        // display data in results section 
                        // display matched show details
                        $("#result-body").html(`<h3>You should watch:<br> <span class="text-success">${data.show_name}<span><br><img src="${data.poster}"/><br><br>${data.plot}</h3><br>`)

                        // matched user details
                        let userSection = $("#result-body").append(`<h3>Others who matched with this show:</h3>`)
                        console.log(data.userMatch)
                        // parse out userMatch array
                        if (!data.userMatch.length) {
                            // if nothing is in array, let user
                            let user = $(`<h3 class="text-warning">No one has matched this show yet.</h3>`)
                        } else {
                            // loop through array
                            for (let i = 0; i < data.userMatch.length; i++) {
                                // display the user name with a link to their photo
                                let user = $(`<h3 class="text-success"><a target="_blank" href="${data.userMatchPhoto[i]}">${data.userMatch[i]}</a></h3>`)
                                console.log(user)
                                $(userSection).append(user)
                            }
                        }
                        // push a button to toggle back to survey
                        $("#result-body").append(`<button class="btn btn-primary" id="show">Show Survey</button>`)


                        // hide survey, show results panel
                        $("#survey").attr("class", "hide")
                        $("#results").attr("class", "card border-dark mb-3 mt-4 top text-center")

                    } else {
                        console.log("no response from server")
                    }

                })
            }
        });

        // event to toggle back to survey form
        $(document).on("click", "#show", function () {
            $("#survey").attr("class", "card border-dark mb-3")
            $("#result-body").empty();
            $("#results").attr("class", "hide")
        });


    </script>
</body>

</html>